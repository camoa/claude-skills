{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://camoa-skills/code-quality-audit/audit-report.schema.json",
  "title": "Code Quality Audit Report",
  "description": "Schema for code quality audit reports generated by code-quality-audit skill",
  "type": "object",
  "required": ["meta", "summary"],
  "properties": {
    "meta": {
      "type": "object",
      "description": "Metadata about the audit",
      "required": ["project_type", "timestamp"],
      "properties": {
        "project_type": {
          "type": "string",
          "enum": ["drupal", "nextjs", "monorepo", "unknown"],
          "description": "Type of project analyzed"
        },
        "project_path": {
          "type": "string",
          "description": "Absolute path to project root"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp of audit"
        },
        "tool_versions": {
          "type": "object",
          "description": "Versions of tools used",
          "additionalProperties": {
            "type": "string"
          }
        },
        "thresholds": {
          "type": "object",
          "description": "Configured thresholds",
          "properties": {
            "coverage_minimum": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "default": 70
            },
            "coverage_target": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "default": 80
            },
            "duplication_max": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "default": 5
            },
            "complexity_max": {
              "type": "integer",
              "minimum": 1,
              "default": 10
            }
          }
        }
      }
    },
    "summary": {
      "type": "object",
      "description": "Summary of audit results",
      "required": ["overall_score"],
      "properties": {
        "overall_score": {
          "type": "string",
          "enum": ["pass", "warning", "fail", "unknown"],
          "description": "Overall audit result"
        },
        "coverage_score": {
          "type": "string",
          "enum": ["pass", "warning", "fail", "unknown"]
        },
        "solid_score": {
          "type": "string",
          "enum": ["pass", "warning", "fail", "unknown"]
        },
        "dry_score": {
          "type": "string",
          "enum": ["pass", "warning", "fail", "unknown"]
        },
        "critical_issues": {
          "type": "integer",
          "minimum": 0,
          "default": 0
        },
        "warnings": {
          "type": "integer",
          "minimum": 0,
          "default": 0
        },
        "suggestions": {
          "type": "integer",
          "minimum": 0,
          "default": 0
        }
      }
    },
    "coverage": {
      "type": "object",
      "description": "Test coverage metrics",
      "properties": {
        "line_coverage": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Line coverage percentage"
        },
        "branch_coverage": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 100,
          "description": "Branch coverage percentage (null if not available)"
        },
        "files_analyzed": {
          "type": "integer",
          "minimum": 0
        },
        "files_covered": {
          "type": "integer",
          "minimum": 0
        },
        "uncovered_files": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "file": {
                "type": "string"
              },
              "coverage": {
                "type": "number",
                "minimum": 0,
                "maximum": 100
              }
            }
          }
        }
      }
    },
    "solid": {
      "type": "object",
      "description": "SOLID principle violations",
      "properties": {
        "violations": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/violation"
          }
        },
        "metrics": {
          "type": "object",
          "properties": {
            "average_complexity": {
              "type": "number"
            },
            "max_complexity": {
              "type": "integer"
            },
            "static_calls": {
              "type": "integer"
            },
            "large_classes": {
              "type": "integer"
            }
          }
        }
      }
    },
    "dry": {
      "type": "object",
      "description": "DRY/duplication analysis",
      "properties": {
        "duplication_percentage": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "total_lines": {
          "type": "integer",
          "minimum": 0
        },
        "duplicated_lines": {
          "type": "integer",
          "minimum": 0
        },
        "clones": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/clone"
          }
        }
      }
    },
    "tdd": {
      "type": "object",
      "description": "Test execution results",
      "properties": {
        "test_count": {
          "type": "integer",
          "minimum": 0
        },
        "passing": {
          "type": "integer",
          "minimum": 0
        },
        "failing": {
          "type": "integer",
          "minimum": 0
        },
        "skipped": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "recommendations": {
      "type": "array",
      "description": "Actionable recommendations",
      "items": {
        "$ref": "#/definitions/recommendation"
      }
    }
  },
  "definitions": {
    "violation": {
      "type": "object",
      "required": ["principle", "severity", "file", "message"],
      "properties": {
        "principle": {
          "type": "string",
          "enum": ["SRP", "OCP", "LSP", "ISP", "DIP", "design"],
          "description": "SOLID principle violated"
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "warning", "suggestion"]
        },
        "file": {
          "type": "string",
          "description": "File path"
        },
        "line": {
          "type": "integer",
          "minimum": 1
        },
        "message": {
          "type": "string",
          "description": "Description of violation"
        },
        "metric": {
          "type": "string",
          "description": "Metric that detected violation"
        },
        "value": {
          "type": "number",
          "description": "Actual metric value"
        },
        "threshold": {
          "type": "number",
          "description": "Threshold that was exceeded"
        }
      }
    },
    "clone": {
      "type": "object",
      "description": "Code clone (duplication)",
      "properties": {
        "lines": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of duplicated lines"
        },
        "tokens": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of tokens"
        },
        "files": {
          "type": "array",
          "minItems": 2,
          "items": {
            "type": "object",
            "properties": {
              "file": {
                "type": "string"
              },
              "start_line": {
                "type": "integer",
                "minimum": 1
              },
              "end_line": {
                "type": "integer",
                "minimum": 1
              }
            }
          }
        }
      }
    },
    "recommendation": {
      "type": "object",
      "required": ["category", "priority", "message"],
      "properties": {
        "category": {
          "type": "string",
          "enum": ["coverage", "solid", "dry", "tdd"]
        },
        "priority": {
          "type": "string",
          "enum": ["high", "medium", "low"]
        },
        "message": {
          "type": "string",
          "description": "What needs attention"
        },
        "action": {
          "type": "string",
          "description": "Suggested fix"
        }
      }
    }
  }
}
